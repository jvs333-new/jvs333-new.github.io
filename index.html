<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Display Webcam Stream</title>
 
<style>
</style>
</head>
 
<body>
<video id="video" autoplay muted playsinline></video>
<canvas id="canvas" width="320" height="240" hidden></canvas>

<script>
const video = document.getElementById("video");

navigator.mediaDevices.getUserMedia({
  video: { facingMode: "user" },
  audio: false
}).then(stream => {
  video.srcObject = stream;
});

const ws = new WebSocket("ws://192.168.178.80:8765");

ws.onopen = () => {
  console.log("WS connected");
};

const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

setInterval(() => {
  ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

  canvas.toBlob(blob => {
    if (ws.readyState === WebSocket.OPEN) {
      ws.send(blob);
    }
  }, "image/jpeg", 0.6);
}, 100); // 10 fps


</script>

</body>
</html>
