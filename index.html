<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Display Webcam Stream</title>
 
<style>
</style>
</head>
 
<body>
<video id="video" autoplay muted playsinline></video>
<canvas id="canvas" width="320" height="240" hidden></canvas>
<pre id="log" style="white-space: pre-wrap;"></pre>


<script>
const logEl = document.getElementById("log");

function writeLog(type, args) {
  const msg = `[${type}] ` + args.map(a =>
    typeof a === "object" ? JSON.stringify(a) : String(a)
  ).join(" ");

  logEl.textContent += msg + "\n";
}

// Bewaar originele functies
const originalLog = console.log;
const originalError = console.error;
const originalWarn = console.warn;

// Override console functies
console.log = (...args) => {
  writeLog("LOG", args);
  originalLog(...args);
};

console.error = (...args) => {
  writeLog("ERROR", args);
  originalError(...args);
};

console.warn = (...args) => {
  writeLog("WARN", args);
  originalWarn(...args);
};

// JS runtime errors
window.onerror = function (msg, url, line, col, err) {
  writeLog("JS ERROR", [msg, `(${line}:${col})`]);
};

// Promise errors
window.onunhandledrejection = function (e) {
  writeLog("PROMISE ERROR", [e.reason]);
};


const video = document.getElementById("video");

navigator.mediaDevices.getUserMedia({
  video: true,
  audio: false
}).then(stream => {
  video.srcObject = stream;
});

const ws = new WebSocket("wss://most-spell-squad-badly.trycloudflare.com");

ws.onopen = () => {
  console.log("WS open");
};

ws.onerror = (e) => {
  console.error("WS error", e);
};

ws.onclose = (e) => {
  console.error(
    "WS closed",
    "code:", e.code,
    "reason:", e.reason,
    "clean:", e.wasClean
  );
};

const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

setInterval(() => {
  ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

  canvas.toBlob(blob => {
    if (ws.readyState === WebSocket.OPEN) {
      ws.send(blob);
    }
  }, "image/jpeg", 0.6);
}, 100); // 10 fps


</script>

</body>
</html>
